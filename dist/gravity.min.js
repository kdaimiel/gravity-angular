/*
 * gravity
 * @Description Gravity 2D model with Velocity & Angular
 * @version v1.0.19 - 2015-07-06
 * @link 
 * @author Enrique Daimiel Ruiz <k.daimiel@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
function Particle(){this.size=.5+3.5*Math.random(),this.position={x:0,y:0},this.shift={x:0,y:0},this.angle=0,this.speed=.01+this.size/4*.0015,this.force=1-.15*Math.random(),this.color="#ffffff",this.orbit=1,this.magnet=null}function Magnet(){this.orbit=100,this.position={x:0,y:0},this.dragging=!1,this.connections=0,this.size=1}angular.module("Gravity.Constants",[]),angular.module("Gravity.Factories",["Gravity.Constants"]),angular.module("Gravity.Services",["Gravity.Factories"]),angular.module("Gravity.Directives",["Gravity.Services"]),angular.module("Gravity.Controllers",["Gravity.Services"]),angular.module("gravity",["Gravity.Controllers","Gravity.Directives"]).run(["$log",function(a){a.debug("Gravity run")}]),function(){function a(a,b){var c=this;c.nextSkin=a.nextSkin,c.previousSkin=a.previousSkin,b.info("GravityController invoked")}angular.module("Gravity.Controllers").controller("GravityController",a),a.$inject=["gravityService","$log"]}(),function(){function a(a,b){function c(c,d,e){var f=d[0].firstChild.firstChild;b.init(f),d.bind("mousedown",function(a){b.onMouseDown(a)}),d.bind("mousemove",function(a){b.onMouseMove(a)}),d.bind("mouseup",function(a){b.onMouseUp(a)}),angular.element(window).bind("resize",function(){b.onWindowResize()}),a.info("Gravity directive loaded")}return{link:c,restrict:"E",template:'<div class="gravity"><canvas ></canvas></div>'}}angular.module("Gravity.Directives").directive("gravity",a),a.$inject=["$log","gravityService"]}(),function(){"use strict";function a(a,b,c,d,e){function f(){for(var a=0;b>a;a++){var c={x:Math.random()*s.clientWidth,y:Math.random()*s.clientHeight};g(c)}}function g(b){var c=new Magnet;c.position.x=b.x,c.position.y=b.y,x.push(c),h(c.position),a.info("Magnet created")}function h(a){for(var b=0;c>b;b++){var d=new Particle;d.position.x=a.x,d.position.y=a.y,d.shift.x=a.x,d.shift.y=a.y,d.color=B[A].particleFill,w.push(d)}}function i(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)}function j(b){w=[],x=[],clearInterval(),s=b,s&&s.getContext&&(t=s.getContext("2d"),r(),f(),setInterval(k,1e3/60),a.info("Gravity model initialized"))}function k(){B[A].useFade?(t.fillStyle=B[A].fadeFill,t.fillRect(0,0,t.canvas.width,t.canvas.height)):t.clearRect(0,0,s.width,s.height);var a,b,c,e,f,g;for(e=0,g=x.length;g>e;e++){b=x[e],b.dragging&&(b.position.x+=.2*(u-b.position.x),b.position.y+=.2*(v-b.position.y)),b.size+=.025*(b.connections/3-b.size),b.size=Math.max(b.size,2);var h=t.createRadialGradient(b.position.x,b.position.y,0,b.position.x,b.position.y,10*b.size);h.addColorStop(0,B[A].glowA),h.addColorStop(1,B[A].glowB),t.beginPath(),t.fillStyle=h,t.arc(b.position.x,b.position.y,10*b.size,0,2*Math.PI,!0),t.fill(),t.beginPath(),t.fillStyle="#00000000",t.arc(b.position.x,b.position.y,b.size,0,2*Math.PI,!0),t.fill(),b.connections=0}for(c=0,f=w.length;f>c;c++){a=w[c];var j=-1,k=-1,l=null,m={x:0,y:0};for(e=0,g=x.length;g>e;e++){if(b=x[e],j=i(a.position,b.position)-.5*b.orbit,a.magnet!==b){var n=b.position.x-a.position.x;n>-d&&d>n&&(m.x+=n/d);var o=b.position.y-a.position.y;o>-d&&d>o&&(m.y+=o/d)}(null===l||k>j)&&(k=j,l=b)}(null===a.magnet||a.magnet!==l)&&(a.magnet=l),l.connections+=1,a.angle+=a.speed,a.shift.x+=(l.position.x+8*m.x-a.shift.x)*a.speed,a.shift.y+=(l.position.y+8*m.y-a.shift.y)*a.speed,a.position.x=a.shift.x+Math.cos(c+a.angle)*a.orbit*a.force,a.position.y=a.shift.y+Math.sin(c+a.angle)*a.orbit*a.force,a.position.x=Math.max(Math.min(a.position.x,s.clientWidth-a.size/2),a.size/2),a.position.y=Math.max(Math.min(a.position.y,s.clientHeight-a.size/2),a.size/2),a.orbit+=.1*(l.orbit-a.orbit),t.beginPath(),t.fillStyle=a.color,t.arc(a.position.x,a.position.y,a.size/2,0,2*Math.PI,!0),t.fill()}}function l(a){a.preventDefault(),y=!0,(new Date).getTime()-z<300&&(g({x:u,y:v}),z=0),z=(new Date).getTime();for(var b=0,c=x.length;c>b;b++){var d=x[b];if(i(d.position,{x:u,y:v})<.5*d.orbit){d.dragging=!0;break}}}function m(a){u=a.clientX-s.offsetLeft+window.pageXOffset,v=a.clientY-s.offsetTop+window.pageYOffset}function n(a){y=!1;for(var b=0,c=x.length;c>b;b++){var d=x[b];d.dragging=!1}}function o(){event.preventDefault(),++A,q()}function p(){event.preventDefault(),--A,q()}function q(){A=0>A?B.length-1:A,A=A>B.length-1?0:A;for(var b=0,c=w.length;c>b;b++)w[b].color=B[A].particleFill;a.info("Skin updated")}function r(){s.width=document.getElementById("gravity")?document.getElementById("gravity").clientWidth:e.WIDTH,s.height=document.getElementById("gravity")?document.getElementById("gravity").clientHeight:e.HEIGHT,u=s.clientWidth-s.offsetLeft,v=s.clientHeight-s.offsetTop,a.info("Windows resized invoked")}var s,t,u,v,w=[],x=[],y=!1,z=0,A=0,B=[{glowA:"rgba(0,200,250,0.3)",glowB:"rgba(0,200,250,0.0)",particleFill:"#ffffff",fadeFill:"rgba(22,22,22,.6)",useFade:!0},{glowA:"rgba(230,0,0,0.3)",glowB:"rgba(230,0,0,0.0)",particleFill:"#ffffff",fadeFill:"rgba(22,22,22,.6)",useFade:!0},{glowA:"rgba(0,230,0,0.3)",glowB:"rgba(0,230,0,0.0)",particleFill:"rgba(0,230,0,0.7)",fadeFill:"rgba(22,22,22,.6)",useFade:!0},{glowA:"rgba(0,0,0,0.3)",glowB:"rgba(0,0,0,0.0)",particleFill:"#333333",fadeFill:"rgba(255,255,255,.6)",useFade:!0},{glowA:"rgba(0,0,0,0.0)",glowB:"rgba(0,0,0,0.0)",particleFill:"#333333",fadeFill:"rgba(255,255,255,.2)",useFade:!0},{glowA:"rgba(230,230,230,0)",glowB:"rgba(230,230,230,0.0)",particleFill:"#ffffff",fadeFill:"",useFade:!1}],C={init:j,nextSkin:o,onMouseDown:l,onMouseMove:m,onMouseUp:n,onWindowResize:r,previousSkin:p,log:a.log};return C}angular.module("Gravity.Services").service("gravityService",a),a.$inject=["$log","MAGNETS_AT_START","PARTICLES_PER_MAGNET","MAGNETIC_FORCE_THRESHOLD","SCREEN"]}(),function(){"use strict";angular.module("Gravity.Constants").constant("MAGNETS_AT_START",4).constant("MAGNETIC_FORCE_THRESHOLD",300).constant("PARTICLES_PER_MAGNET",20).constant("SCREEN",{HEIGHT:400,WIDTH:400})}(),angular.module("Gravity.Factories").factory("Particle",Particle),angular.module("Gravity.Factories").factory("Magnet",Magnet);